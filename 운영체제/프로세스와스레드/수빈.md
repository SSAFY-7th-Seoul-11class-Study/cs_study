```
프로세스와 스레드 예상질문

1. 데드락을 설명하고 발생조건 4가지를 말해보세요.
2. IPC에 대해 설명해보세요.
  -> IPC 방법
3. 프로세스와 스레드의 차이를 설명해보세요.
4. Race condition이 발생할 수 있는 상황을 말해보세요.
5. Critical section의 해결방안을 말해보세요.
  -> Mutex와 Semaphore의 차이점을 설명해보세요.
6. 프로세스의 메모리 구조에 대해 설명해보세요.
  -> 데이터 영역과 스택 영역의 차이
7. Multitasking이란?
8. Multi-processing에 대해 설명해보세요.
9. Program Counter란?
10. 스레드의 장단점을 설명해보세요.
11. TCB란?
```

# Process란?

실행중인 프로그램, CPU 스케줄링의 대상이 되는 작업이다.

- 운영체제 프로세스
- 사용자 프로세스

```
- 프로세스는 각각의 독립된 메모리 영역을 할당받는다.
- 기본적으로 프로세스당 최소 1개의 스레드(메인 스레드)를 가지고 있다.
- 각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다.
```

<br>

## 프로세스 상태

1. Ready : 메모리 공간이 충분하면 메모리를 할당받고 아니면 아닌 상태로 대기하고 있으며 CPU 제어권을 기다리는 상태
2. Running : CPU 제어권과 메모리를 할당받고 실행 중인 상태 (CPU burst 상태)
3. Blocked : I/O 이벤트 등의 발생으로 인해 프로세스가 중단된 상태(CPU 제어권을 가져도 실행할 수 없는 상태)

---

4. New : 프로세스가 생성된 상태 (fork(), exec() 함수를 통해 생성되고 PCB가 할당됨)
5. Terminated : 프로세스 수행이 끝난 상태, 스스로 종료되는 것도 있지만 강제로 종료되는 경우도 있음(kill)

<br>

## 프로세스의 메모리 구조

> 동적 영역

1. 스택(Stack) : 지역변수, 매개변수, 함수가 저장되고 컴파일 시에 크기가 결정
2. 힙(Heap) : 동적 할당 시 사용되며 런타임 시 크기가 결정

> 정적 영역

1. 데이터 영역(Data) : 전역변수, 정적변수를 저장
   - Data segment : 초기화가 된 변수들이 저장
   - BSS segment : 초기화가 되지 않은 변수가 0으로 초기화 되어 저장
2. 코드 영역(Code) : 프로그램에 내장되어 있는 소스 코드가 존재하는 영역

<br>

## PCB(Process Control Block, 프로세스 제어 블럭)

운영체제가 프로세스를 관리하기 위해 프로세스에 대한 메타데이터를 저장한 데이터.
프로세스의 중요한 정보를 포함하고 있기 때문에 커널 스택에서 관리.

```
< PCB 구성 >
1. 프로세스 상태
2. 프로세스 ID
3. 스케줄링 정보
4. Program Counter(PC)
5. registers
6. I/O 상태 정보
7. 프로세스 계정 정보
8. 메모리 정보
```

<br>

## Context Switch(문맥교환)

System call이나 Interrupt 발생 시 실행 중인 프로세스의 PCB를 저장한 후, 커널에서 실행할 프로세스의 PCB를 가져와 CPU 제어권을 넘겨주는 과정을 말한다.

<br>

## Multi-processing(멀티프로세싱)

하나의 컴퓨터에 CPU가 2개 이상이다. 여러 개의 process를 동시에 수행할 수 있는 것을 뜻한다.
하나 이상의 일을 병렬로 처리할 수 있고, 특정 프로세스에 문제가 발생 시 다른 프로세스를 이용해서 처리할 수 있으므로 신뢰성이 높다.

<br>

## IPC(Inter Process Communication, 협력 메커니즘)

프로세스끼리 데이터를 주고받고 공유 데이터를 관리하는 메커니즘으로 멀티프로세스는 IPC가 가능하다.

1. Shared Memory : 서로 다른 프로세스 간에 공유하는 메모리를 통해 협력한다.
2. Unamed pipe : FIFO 방식으로, 파이프를 기반으로 데이터를 주고받으며 읽기 전용, 쓰기 전용 파이프를 만들어서 작동하는 방식을 말한다.
3. Named pipe : 파이프 서버와 하나 이상의 파이프 클라이언트 간의 통신을 위한 단방향 또는 양방향 파이프를 말한다.
4. Message Queue : 메시지를 Queue 구조 형태로 관리하는 것을 의미한다.
5. 소켓 : 동일한 컴퓨터의 다른 프로세스나 네크워크의 다른 컴퓨터로 전송하는 데이터를 의미한다.

<br>
<br>
<br>

# Thread란?

하나의 프로세스 내부의 CPU 수행단위가 여러 개 있는 경우에 그 단위를 thread라고 한다.

`스레드는 코드, 데이터, 힙 영역을 스레드끼리 서로 공유하고, 스택 영역은 각각 생성된다.`

```
< thread 구성 >
1. Program Counter(PC)
2. register set
3. stack space
```

### thread의 장점

- 응답성이 좋다 : 하나의 프로세스에서 어떤 스레드가 blocked된 경우 CPU 제어권을 넘기지 않고 현재 프로세스의 다른 스레드에게 넘기면 빠른 처리가 가능하다.
- 자원 공유
- 경제성 : 동일한 일을 수행하는 작업을 별도의 thread로 관리하면서 자원 절약이 가능하다.
- Multi-processing Arch.의 utilization : (다중 CPU) 각각의 스레드가 병렬적으로 실행될 수 있다.

<br>

## Multi-threading(멀티스레딩)

프로세스 내 작업을 여러 개의 스레드로 처리하는 기법을 말한다.
<br>스레드끼리 서로 자원을 공유하기 때문에 효율성이 높고 동시성에도 큰 장점이 있다.
<br>하지만 하나의 스레드에 문제가 생기면 프로세스에 영향을 줄 수 있는 단점이 있다.

<br>

## Shared resource(공유자원)

시스템 안에서 각 프로세스, 스레드가 함께 접근할 수 있는 자원이나 변수 등을 의미한다.

```
Race condition(경쟁 상태)
공유 자원을 두 개 이상의 프로세스가 동시에 접근을 시도할 때 접근의 타이밍이나 순서 등이 결과값에 영향을 줄 수 있는 상황

언제 발생?
1. kernel 수행 중 interrupt 발생 시
  ➡️ interrupt를 disable 상태로 변경
2. 프로세스가 System call하여 kernel mode로 수행 중 context switch가 발생 시
  ➡️ CPU 제어권을 넘기지 않는다.
3. Multiprocessor에서 공유메모리 내의 kernal data 접근 시
  ➡️ 하나의 CPU만이 커널에 들어갈 수 있게 한다 / 접근할 공유 데이터에 대한 lock/unlock
```

<br>

## Critical section(임계 영역)

공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 영역. 해결 방법은 lock을 이용하는 것

> 해결 방안 : 뮤텍스, 세마포어, 모니터 -> 상호 배제, 한정 대기, 융통성 조건을 모두 만족해야한다.

<br>

## Mutex(뮤텍스)

공유자원을 사용하기 전에 잠금을 설정하고 사용한 후에는 잠금을 해제하는 방법. 하나의 상태만 가진다.

<br>

## Semaphore(세마포어)

일반화된 뮤텍스로 정수 값과 wait(P함수), signal(V함수)를 이용하여 공유 자원에 대한 접근을 처리하는 방법
<br>'wait'은 자신의 차례가 올 때까지 기다리는 함수
<br>'signal'은 공유 자원을 사용한 후 다음 프로세스로 순서를 넘겨주는 함수
<br>

- binary semaphore : 0, 1 값만 가질 수 있는 세마포어
- counting semaphore : 여러 개의 값을 가질 수 있는 세마포어

<br>

## Monitor(모니터)

둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유 자원을 숨기고 해당 접근에 대해 인터페이스만 제공하는 방법
<br>모니터 큐를 이용하여 공유 자원에 대한 작업들을 순차적으로 처리한다

<br>

## Deadlock(교착상태)

두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 무한히 중단된 상태

> 교착상태의 발생 조건(4가지를 모두 만족해야 한다.)

1. 상호배제(Mutual exclusion) : 한 프로세스가 자원을 독점하고 있으며 다른 프로세스들은 접근이 불가능하다
2. 점유 대기(Hold and Wait) : 특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태
3. 비선점(No preemption) : 다른 프로세스의 자원을 강제적으로 가져올 수 없다.
4. 환형 대기(Circular wait) : 순환 형태로 서로가 서로의 자원을 요구하는 상황

<br>

> 해결 방법

1. 예방(prevention) : 교착 상태 발생 조건 중 하나를 제거하면서 해결한다.
2. 회피(avoidance) : 교착 상태 가능성이 없을 때만 자원을 할당해준다. ➡️ `은행원 알고리즘`
3. 탐지(Detection) : 교착 상태가 발생하면 사이클이 있는지 찾아보는 것이다.
4. 회복(Recovery) : 교착 상태를 일으킨 프로세스를 종료시킨다.
