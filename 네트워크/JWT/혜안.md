### 예상질문
```
1. JWT에 대해 설명해주세요.
2. JWT의 구조를 설명해주세요.
3. JWT의 장단점에 대해 설명해주세요.
4. 세션 기반 인증 방식과 토큰 기반 인증 방식에 대해 설명하고, 가장 큰 차이를 말해주세요.
5. Refresh Token에 대해 설명해주세요.
```

## JWT(JSON Web Token)이란?
- Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token이다.
JWT는 토큰 자체를 정보로 사용하는 SElf-Contained(자가 수용적) 방식으로 정보를 안전하게 전달한다.  
  -  로그인
       - 사용자 로그인 -> 서버가 해당 유저의 토큰을 유저에게 전달 (JWT)  
        -> 유저가 유청을 할때 토큰을 포함해서 전달  
        -> 서버는 해당 토큰일 권한이 있는지 유효하고 인증이 되었는지 확인하고 작업을 진행
       - 서버는 유저의 세션을 유지할 필요가 없다.  
        -> 유저가 보낸 토큰만 확인하면 된다.  
        -> 서버의 자원을 아낄수 있다.
  - 정보교류  
     - JWT는 두 개체 사이에서 안정성있게 정보를 교환하기에 좋은 방법이다.
그 이유는, 정보가 sign 이 되어있기 때문에 정보를 보낸이가 바뀌진 않았는지,
또 정보가 도중에 조작되지는 않았는지 검증할 수 있다.

## JWT의 구성요소
JWT는 `.` 을 구분자로 3가지의 문자열로 구성되어 있다.

aaaa.bbbbb.ccccc 의 구조로 앞부터 헤더(header), 내용(payload), 서명(signature)로 구성된다.

### 헤더 (Header)
- type과 algorithm으로 구성된다.
```
{
	"typ" : "JWT",
	"alg" : "HS256"
}
```

### 정보(payload)
- 각 사용자의 인증에 사용할 정보를 담는다.
- 단, 이 Payload에는 사용자의 개인정보를 담을 수 있는 어떤 내용도 담아서는 안된다.
이부분은 Base64로만 인코딩되기 때문에, 이를 복원하면 시그니쳐의 내용이 없더라도 이 내용을 알아낼 수 있어, 사용자의 개인정보가 유출될 위험성이 있기 때문이다.
그래서 외부에 유출되어도 상관이없으면서도 고유한 값인 id값, 그리고 해당 토큰의 만료시각 정도를 넣는다.

### 서명(signature)
- 헤더의 인코딩값과, 정보의 인코딩값을 합친후 주어진 비밀키로 해쉬를 하여 생성한다.
이렇게 만든 해쉬를 `base64`형태로 나타내게 된다.

## JWT의 장단점
- 장점
    - Self-Contained 의 특성에 따라서 별도의 인증 저장소를 필요로 하지 않는다.
    - MSA 환경에서 중앙 집중식 인증 서버와 DB에 의존하지 않는 인증 및 인가 방법을 제공한다.
    - 유효성 검사 과정에서 IO 또는 네트워크 액세스를 필요로 하지 않고, 최신 웹 서버 HW에서 확장이 용이하다.
    - 기타 사용을 권장하는 요소들
        - URL  파라미터와 헤더로 사용
        - 수평 스케일이 용이
        - 디버깅 및 관리가 용이
        - 트래픽 대한 부담이 낮음
        - REST 서비스로 제공 가능
        - 내장된 만료
        - 독립적인 JWT
- 단점
  - 토큰은 클라이언트에 저장되어 데이터베이스에서 사용자 정보를 조작하더라도 토큰에 직접 적용할 수 없다.
  - 더 많은 필드가 추가되면 토큰이 커질 수 있다.
  - 비상태 애플리케이션에서 토큰은 거의 모든 요청에 대해 전송되므로 데이터 트래픽 크기에 영향을 미칠 수 있다.
  - 중요한 부분인 Payload 파트가 암호화되지 않기 때문에 추가적인 암호화 방안을 고려하거나, Payload에 중요한 데이터를 넣지 않고 운영해야 한다.
  - 토큰 자체에서 상태를 관리하지 않기때문에 등록된 클레임에 해당하는 데이터 중 만료와 관련된 데이터를 필수로 사용해야 한다.

## 세션 기반 인증과 토큰 기반 인증
### 세션 기반 인증 방식
- 클라이언트에게 세션 ID를 발급해, 세션 정보를 서버에 저장해 사용자를 검증하는 방식
### 토큰 기반 인증 방식
- 따로 정보를 DB에 저장하지 않고 인증된 사용자에게 토큰을 발급하여, 서버에 요청 시 토큰을 함께 보내고, 이 토큰이 유효한지 확인하여 검증하는 방식
### 세션기반 인증방식과 토큰기반 인증방식의 차이 (Token 기반 vs Session 기반)
- 두방식의 가장 큰 차이점은, 세션은 데이터베이스 서버에 저장된다는 점,토큰은 클라이언트 측에서 저장한다는 점이다.

## Refresh Token
- JWT로그인 방식에 사용되는 JWT의 보안상의 단점을 보완하기 위해 구현한다.
- 사용자가 로그인하여 리소스에 접근할 수 있는 토큰을 Access Token이라 한다.
Access Token을 어떻게하던지 탈취하면(클라이언트 상에 노출되어있으므로 비교적 탈취가 쉽다고한다.) 
해커는 로그인 한 유저처럼 리소스에 접근할 수 있다. 
그래서 로그인으로 발급한 Access Token의 유효기간을 짧게하여 공격받을 면적을 줄이는 것으로 보안성을 높인다.   
-> 이러한 단점을 보완하고자 고안된 것이 Refresh Token이다. 

- Refresh Token이 사용되는 방식은,
1. Access Token과 Refresh Token의 발급
2. Access Token에 짧은 만료 주기 설정 (30분~ 등의 짧은 시간)
3. Refresh Token으로 Access Token을 재발급
4. 기존의 Access Token은 폐기

