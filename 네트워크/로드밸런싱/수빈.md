```
로드밸런싱 문제
1. 서버 확장의 두 가지 방식을 설명해보세요
  - Scale-Out 방식에 필요한 기술은 무엇인가요
2. 로드밸런싱을 설명해보세요
3. 로드밸런싱의 기능 중 Health Check에 대해 설명해보세요
4. L4, L7 로드밸런서가 가장 많이 활용되는 이유를 설명해보세요
5. L4 로드밸런서의 장단점을 설명해보세요
6. L7 로드밸런서의 장단점을 설명해보세요
7. SNAT과 DNAT의 차이점
```

<br>

## 서버 확장의 두 가지 방식

1. Scale-Up 방식

   - 기존의 서버 성능을 확장

2. Scale-Out 방식
   - 기존의 서버와 동일하거나 낮은 성능의 서버를 증설
   - 로드밸런싱 기술 필요!

<br>

# 로드밸런싱이란

서버가 처리해야 할 업무 혹은 요청(load)을 여러 대의 서버로 나누어(Balancing) 처리하는 것을 의미한다.
한 대의 서버로 부하가 집중되지 않도록 트래픽을 관리해 각각의 서버가 가용성 및 응답시간에 대한 최적의 퍼포먼스를 보일 수 있도록 하는 것이 목적이다.

<br>

## 로드밸런싱의 기본 기능

1. Health Check(상태확인)

- 서버들에 대한 주기적인 Health Check를 통해 서버들의 장애 여부를 판단하여, 정상 동작 중인 서버로만 트래픽을 보낸다.
  - L3 : IP 주소 통신 가능 상태
  - L4 : 포트 상태
  - L7 : 실제 웹페이지 통신 상태

2. Tunneling(터널링)

- 데이터 스트림을 인터넷 상에서 가상의 파이프를 통해 전달시키는 기술
- 패킷 내에 터널링할 대상을 캡슐화시켜 목적지까지 전송
- 연결된 상호 간에만 캡슐화된 패킷을 구별해 캡슐화를 해제

3. NAT(Network Address Translation)

- 내부 네트워크에서 사용하는 사설 IP 주소와 로드밸런서 외부의 공인 IP 주소 간의 변환 역할
- 여러 개의 요청은 하나의 공인 IP를 통해 접속하는 것이 목적
- SNAT(Source Network Address Translation) : 내부에서 외부로 트래픽이 나가는 경우
- DNAT(Destination Network Address Translation) : 외부에서 내부로 트래픽이 들어오는 경우

4. DSR(Destination Network Address Translation)

- 서버에서 클라이언트로 트래픽이 되돌아가는 경우, 네트워크 장비나 로드밸런서를 거치지 않고 바로 클라이언트를 찾아가는 방식
- 로드밸런서의 부하를 줄일 수 있음

<br>

## 로드밸런싱 알고리즘

- 라운드로빈 방식

  - 서버에 들어온 요청을 `순서대로 돌아가며` 배분하는 방식.
  - 요청을 순서대로 분배하기 때문에 여러 대의 `서버가 동일한 스펙`을 갖고 있고, 서버와의 `연결이 오래 지속되지 않는 경우`에 활용하기 적합

- 가중 라운드로빈 방식

  - 각각의 서버마다 가중치를 매기고 `가중치가 높은 서버에 요청을 우선적으로 배분`하는 방식
  - `서버의 트래픽 처리 능력이 상이한 경우` 사용되는 방식이다.

- IP 해시 방식

  - `클라이언트의 IP 주소를 특정 서버로 매핑`하여 요청을 배분하는 방식
  - 사용자의 IP를 해싱하여 로드를 분배하기 때문에 사용자는 항상 동일한 서버로 연결되는 것을 보장

- 최소 연결 방식

  - 요청이 들어온 시점에 `가장 적은 연결상태를 보이는 서버에 우선적으로` 배분하는 방식.
  - 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합한 방식

- 최소 응답 시간 방식
  - 서버의 `현재 연결 상태와 응답 시간을 모두 고려`하여 트래픽을 배분하는 방식.
  - 가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 로드를 배분하는 방식

<br>

## 로드밸런싱에서 가장 많이 활용되는 것 ➡️ L4 로드밸런서, L7 로드밸런서

```
L4, L7 로드밸런서를 가장 많이 활용하는 이유는 L4 로드밸런서부터 포트 정보를 바탕으로 로드를 분산 가능하기 때문이다.
따라서 한 대의 서버에 다른 포트 번호를 부여하여 다수의 프로그램을 운영하는 경우라면 최소 L4 로드밸런서 이상을 사용해야 한다.
```

### L4 로드밸런서

- Layer 4(전송 계층)
- 네트워크 계층(IP,IPX)이나 전송 계층(TCP/UDP)의 정보를 바탕으로 로드를 분산
- IP, 포트번호, MAC 주소, 전송 프로토콜에 따라 로드를 분산

> 장점

- 패킷의 내용을 확인하지 않고 로드를 분산하므로 속도가 빠르고 효율을 높다.
- 데이터의 내용을 복호화할 필요가 없기에 안전
- L7 로드밸런서보다 가격이 저렴하다.

> 단점

- 패킷의 내용을 살펴볼 수 없으므로 섬세한 라우팅이 불가능
- 사용자의 IP가 수시로 바뀌는 경우에 연속적인 서비스를 제공하기 어려움

### L7 로드밸런서

- Layer 7(응용 계층)
- 애플리케이션 계층에서 로드를 분산하기 때문에 Http 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 분산
- 패킷의 내용을 확인하고 그 내용에 따라 분배가 가능
- 특정한 패턴을 지닌 바이러스를 감지해 네트워크를 보호 가능
- Dos/DDoS와 같은 비정상적인 트래픽을 필러팅 가능

> 장점

- 상위 계층에서 로드를 분산하기 때문에 섬세한 라우팅 가능
- 캐싱 기능 제공
- 비정상적인 트래픽을 사전에 필터링할 수 있어 서비스 안정성 높음

> 단점

- L4 로드밸런서에 비해 비쌈
- 패킷의 내용을 복호화하여야 하므로 더 높은 비용을 지불해야 함
- 클라이언트가 로드밸런서와 인증서를 공유하기 때문에 보안상의 위험성 존재
