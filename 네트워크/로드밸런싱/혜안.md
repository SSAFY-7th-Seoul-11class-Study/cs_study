### 예상질문
```
1. 로드 밸런싱(Load Balancing) 에 대해 말해주세요.
2. 로드 밸런서가 서버를 선택하는 방식 3가지를 말해주세요.
3. L4 로드 밸런싱과 L7 로드 밸런싱에 대해 설명하고, 차이를 말해주세요.
4. L4 로드 밸런서의 장단점에 대해 말해주세요.
5. L7 로드 밸런서의 장단점에 대해 말해주세요.
6. 로드 밸런싱의 기본 기능 4가지에 대해 말해주세요.
```
## 로드 밸런싱(Load Balancing)
> 둘 이상의 CPU or 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것
<br>

<img src="https://www.educative.io/api/collection/5668639101419520/5649050225344512/page/5747976207073280/image/5696459148099584.png">

요즘 시대에는 웹사이트에 접속하는 인원이 급격히 늘어나게 되었다.

따라서 이 사람들에 대해 모든 트래픽을 감당하기엔 1대의 서버로는 부족하다. 대응 방안으로 하드웨어의 성능을 올리거나(Scale-up) 여러대의 서버가 나눠서 일하도록 만드는 것(Scale-out)이 있다. 하드웨어 향상 비용이 더욱 비싸기도 하고, 서버가 여러대면 무중단 서비스를 제공하는 환경 구성이 용이하므로 Scale-out이 효과적이다. 이때 여러 서버에게 균등하게 트래픽을 분산시켜주는 것이 바로 **로드 밸런싱**이다.

<br>

**로드 밸런싱**은 분산식 웹 서비스로, 여러 서버에 부하(Load)를 나누어주는 역할을 한다. Load Balancer를 클라이언트와 서버 사이에 두고, 부하가 일어나지 않도록 여러 서버에 분산시켜주는 방식이다. 서비스를 운영하는 사이트의 규모에 따라 웹 서버를 추가로 증설하면서 로드 밸런서로 관리해주면 웹 서버의 부하를 해결할 수 있다.

<br>

## 로드밸런싱 기법

서버의 능력을 고려하여 분배해야하기 때문에 서버의 상황에 맞춰 적절한 방법을 선택해야 한다.
<br>

1. 라운드로빈 방식(Round Robin Method)

* 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
* 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 가짐
* 서버와의 연결(세션)이 오래 지속되지 않는 경우에 적합

2. 가중 라운드로빈 방식(Weighted Round Robin Method)

* 각각의 서버마다 가중치를 매기고, 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분하는 방식
* 서버의 트래필 처리 능력이 상이한 경우 주로 사용됨

3. IP 해시 방식(IP Hash Method)

* 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식
* 사용자의 IP를 해싱해 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장
  (\* 해싱 : 임의의 길이를 지닌 데이터를 고정된 길이의 데이터로 매핑하는 것, 또는 그러한 함수)

4. 최소 연결 방식(Least Connection Method)

* 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분
* 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우 적합

5. 최소 응답 시간 방식(Least Response Time Method)

* 서버의 현재 연결 상태와 응답시간을 모두 고려하여 트래픽을 배분하는 방식
* 가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 로드를 배분

## 로드밸런싱의 기본 기능

1. Health Check(상태확인)

- 서버들에 대한 주기적인 Health Check를 통해 서버들의 장애 여부를 판단하여, 정상 동작 중인 서버로만 트래픽을 보낸다.
  - L3 : IP 주소 통신 가능 상태
  - L4 : 포트 상태
  - L7 : 실제 웹페이지 통신 상태

2. Tunneling(터널링)

- 데이터 스트림을 인터넷 상에서 가상의 파이프를 통해 전달시키는 기술
- 패킷 내에 터널링할 대상을 캡슐화시켜 목적지까지 전송
- 연결된 상호 간에만 캡슐화된 패킷을 구별해 캡슐화를 해제

3. NAT(Network Address Translation)

- 내부 네트워크에서 사용하는 사설 IP 주소와 로드밸런서 외부의 공인 IP 주소 간의 변환 역할
- 여러 개의 요청은 하나의 공인 IP를 통해 접속하는 것이 목적
- SNAT(Source Network Address Translation) : 내부에서 외부로 트래픽이 나가는 경우
- DNAT(Destination Network Address Translation) : 외부에서 내부로 트래픽이 들어오는 경우

4. DSR(Destination Network Address Translation)

- 서버에서 클라이언트로 트래픽이 되돌아가는 경우, 네트워크 장비나 로드밸런서를 거치지 않고 바로 클라이언트를 찾아가는 방식
- 로드밸런서의 부하를 줄일 수 있음

## L4 로드 밸런싱 & L7 로드 밸런싱

<img src="https://user-images.githubusercontent.com/98465383/183886817-d088282a-6dee-4774-bcd4-dc25dbb9a15a.png">

* 가장 많이 활용되는 로드 밸런싱
* L4: Layer 4(전송 계층)프로토콜, L7: Layer 7(응용 계층)프로토콜의 헤더를 부하 분산에 이용하기 때문에 붙은 접두사

### L4 로드 밸런서
* 네트워크 계층(IP, IPX)이나 전송계층(TCP, UDP)의 정보(IP주소, 포트번호, MAC주소, 전송 프로토콜)를 바탕으로 로드를 분산

### L7 로드 밸런서

* 어플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능
* 패킷의 내용을 확인하고, 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능
* URL에 따라 부하를 분산시키거나, HTTP 헤더의 쿠키 값에 따라 부하를 분산하는 등 클라이언트의 요청을 보다 세분화해 서버에 전달 가능
* 특정한 패턴을 지닌 바이러스를 감지하여 네트워크 보호 가능
* Dos/DDoS와 같은 비정상적인 트래픽을 필터링할 수 있음

